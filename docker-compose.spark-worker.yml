services:
  spark-worker:
    image: ghcr.io/jmhwang-dev/warehouse:sp3.5.6-ice1.9.1
    container_name: spark-worker
    
    network_mode: host
    restart: unless-stopped
    
    environment:
      - SPARK_NO_DAEMONIZE=true
      - SPARK_LOCAL_IP=${SPARK_LOCAL_IP}
      - SPARK_WORKER_CORES=${SPARK_WORKER_CORES}
      - SPARK_WORKER_MEMORY=${SPARK_WORKER_MEMORY}
      - SPARK_WORKER_WEBUI_PORT=${SPARK_WORKER_WEBUI_PORT}

    volumes:
      - ./configs/spark:/opt/spark/conf:ro
      - ./infra/shared:/mnt/shared/
      - ./configs/jmx/spark_executor.yml:/mnt/configs/jmx/spark_executor.yml
      
    command: >
      /opt/spark/bin/spark-class org.apache.spark.deploy.worker.Worker
      spark://${SPARK_MASTER_HOST}:${SPARK_MASTER_PORT}