# =========================================================
# 1. 공통 시스템 설정
# =========================================================
spark.sql.session.timeZone       UTC
spark.driver.maxResultSize       2g
spark.sql.shuffle.partitions     5

# =========================================================
# 2. 이벤트 로그 (MinIO로 중앙화 - 중요!)
# =========================================================
spark.eventLog.enabled           true
spark.eventLog.dir               s3a://spark-events/
spark.history.fs.logDirectory    s3a://spark-events/

# =========================================================
# 3. MinIO & S3A 연결 (Desktop IP: 192.168.45.191)
# =========================================================
# 모든 노드가 Desktop의 MinIO를 바라보게 설정
spark.hadoop.fs.s3a.endpoint                http://192.168.45.191:9000
spark.hadoop.fs.s3a.access.key              minioadmin
spark.hadoop.fs.s3a.secret.key              minioadmin
spark.hadoop.fs.s3a.path.style.access       true
spark.hadoop.fs.s3a.connection.ssl.enabled  false
spark.hadoop.fs.s3a.impl                    org.apache.hadoop.fs.s3a.S3AFileSystem

# =========================================================
# 4. Iceberg Catalog (Desktop IP: 192.168.45.191)
# =========================================================
spark.sql.extensions                                 org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.defaultCatalog                             warehousedev
spark.sql.catalogImplementation                      in-memory

# REST Catalog
spark.sql.catalog.warehousedev                       org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.warehousedev.type                  rest
spark.sql.catalog.warehousedev.uri                   http://192.168.45.191:8181
spark.sql.catalog.warehousedev.io-impl               org.apache.iceberg.aws.s3.S3FileIO
spark.sql.catalog.warehousedev.warehouse             s3://warehousedev
spark.sql.catalog.warehousedev.s3.endpoint           http://192.168.45.191:9000
spark.sql.catalog.warehousedev.s3.path-style-access  true
spark.sql.catalog.warehousedev.s3.region             us-east-1
spark.sql.catalog.warehousedev.s3.access-key-id      minioadmin
spark.sql.catalog.warehousedev.s3.secret-access-key  minioadmin

# =========================================================
# 5. 리소스 관리 (동적 할당)
# =========================================================
spark.dynamicAllocation.enabled                      true

# 셔플 트래킹: 이게 없으면 드라이버가 워커를 할당받지 못하고 멈춤
spark.dynamicAllocation.shuffleTracking.enabled      true
spark.dynamicAllocation.minExecutors                 1
spark.dynamicAllocation.maxExecutors                 6
spark.dynamicAllocation.initialExecutors             1


# =========================================================
# 6. 하드웨어 스펙 (안전망)
# =========================================================

# deploy-mode가 client일 때는 spark.driver.cores는 무시
spark.driver.memory              2g
spark.driver.cores               1
spark.executor.memory            2g
spark.executor.cores             2
spark.executor.allowMixedArchitectures true