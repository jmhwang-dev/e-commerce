graph LR
  subgraph Kafka ["Kafka"]
direction TB
subgraph Topics ["Topics"]
direction LR
RAW_TOPIC[(review_raw)]
DLQ_TOPIC[(review_dlq)]
INFERENCE_TOPIC[(inferenced_review)]
GOLD_TOPIC[(review_cdc_gold)]
end
KAFKA_CONNECT[Kafka Connect]
end
subgraph FastAPI ["FastAPI"]
API_ENDPOINT[FastAPI Endpoint]
SERIALIZER[Avro Serializer]
VALIDATOR{{Schema Valid?}}
ERR_HANDLER[Error Handler]
end
subgraph SparkProcessing ["Spark Processing"]
direction LR
PREPROCESS[Spark Job: Preprocessing]
REPROCESS[Spark Job: Reprocessing
RocksDB & Auto Retry]
AGGREGATE[Spark Job: Aggregation]
end
INFERENCE[Inference Server: Hugging Face Transformers]
subgraph IcebergLakehouse ["Iceberg Lakehouse"]
direction LR
BRONZE[(bronze)]
SILVER[(silver)]
GOLD[(gold)]
end
subgraph Monitoring ["Monitoring"]
PROMETHEUS[Prometheus: System Metrics]
GRAFANA[Grafana Dashboard: Real-time Alerts]
end
subgraph AnalyticsGovernance ["Analytics & Governance"]
DATAHUB[DataHub: Metadata & Lineage]
SUPERSET[Superset Dashboard: Complaint Trends]
end
START((Start)) -->|Post:Review_Data| API_ENDPOINT
API_ENDPOINT -->|Serialize:Review_Data| SERIALIZER
SCHEMA_REG[Confluent Schema Registry] -->|Fetch:Avro_Schema| SERIALIZER
SCHEMA_REG -->|Fetch:Avro_Schema| REPROCESS
SERIALIZER -->|Validate:Avro_Data| VALIDATOR
VALIDATOR -->|Publish:Valid_Avro_Data| RAW_TOPIC
VALIDATOR -->|Handle:Error_Data| ERR_HANDLER
ERR_HANDLER -->|Produce:Error_Avro_Data| DLQ_TOPIC
DLQ_TOPIC -->|Consume:Error_Avro_Data| REPROCESS
REPROCESS -->|Publish:Valid_Avro_Data| RAW_TOPIC
RAW_TOPIC -->|Consume:Raw_Avro_Data| PREPROCESS
PREPROCESS -->|Publish:Inference_Data| INFERENCE_TOPIC
PREPROCESS -->|Persist:Bronze_Data| BRONZE
PREPROCESS -->|Merge:Cleaned_Data| SILVER
INFERENCE_TOPIC -->|Consume:Inference_Data| INFERENCE
INFERENCE -->|Merge:Translated_Data| SILVER
SILVER -->|Emit:CDC_Events| KAFKA_CONNECT
KAFKA_CONNECT -->|Emit:CDC_Events| GOLD_TOPIC
GOLD_TOPIC -->|Consume:CDC_Events| AGGREGATE
AGGREGATE -->|Persist:Aggregated_Data| GOLD
GOLD -->|Query:Aggregated_Data| SUPERSET
BRONZE -->|Ingest:Metadata| DATAHUB
SILVER -->|Ingest:Metadata| DATAHUB
GOLD -->|Ingest:Metadata| DATAHUB
RAW_TOPIC -->|Collect:Metrics| PROMETHEUS
PREPROCESS -->|Collect:Metrics| PROMETHEUS
INFERENCE -->|Collect:Metrics| PROMETHEUS
PROMETHEUS -->|Visualize:Metrics| GRAFANA
style START fill:#d9d9d9,stroke:#FFFFFF,stroke-width:1px,color:#000000
style SCHEMA_REG fill:#00A7B5,stroke:#FFFFFF,stroke-width:1px,color:#000000
style VALIDATOR fill:#009688,stroke:#FFFFFF,stroke-width:1px,color:#000000
style RAW_TOPIC fill:#000000,stroke:#FFFFFF,stroke-width:1px,color:#FFFFFF
style DLQ_TOPIC fill:#000000,stroke:#FFFFFF,stroke-width:1px,color:#FFFFFF
style INFERENCE_TOPIC fill:#000000,stroke:#FFFFFF,stroke-width:1px,color:#FFFFFF
style GOLD_TOPIC fill:#000000,stroke:#FFFFFF,stroke-width:1px,color:#FFFFFF
style API_ENDPOINT fill:#009688,stroke:#FFFFFF,stroke-width:1px,color:#000000
style SERIALIZER fill:#009688,stroke:#FFFFFF,stroke-width:1px,color:#000000
style ERR_HANDLER fill:#009688,stroke:#FFFFFF,stroke-width:1px,color:#000000
style PREPROCESS fill:#E25A1C,stroke:#FFFFFF,stroke-width:1px,color:#000000
style BRONZE fill:#CD7F32,stroke:#FFFFFF,stroke-width:1px,color:#000000
style SILVER fill:#C0C0C0,stroke:#FFFFFF,stroke-width:1px,color:#000000
style GOLD fill:#FFD700,stroke:#FFFFFF,stroke-width:1px,color:#000000
style SUPERSET fill:#6B46C1,stroke:#FFFFFF,stroke-width:1px,color:#000000
style GRAFANA fill:#F5A623,stroke:#FFFFFF,stroke-width:1px,color:#000000
style DATAHUB fill:#0052CC,stroke:#FFFFFF,stroke-width:1px,color:#000000
style PROMETHEUS fill:#E6522C,stroke:#FFFFFF,stroke-width:1px,color:#000000
style KAFKA_CONNECT fill:#000000,stroke:#FFFFFF,stroke-width:1px,color:#FFFFFF
style REPROCESS fill:#E25A1C,stroke:#FFFFFF,stroke-width:1px,color:#000000
style INFERENCE fill:#009688,stroke:#FFFFFF,stroke-width:1px,color:#000000
style AGGREGATE fill:#E25A1C,stroke:#FFFFFF,stroke-width:1px,color:#000000
style Kafka fill:#f0f0f0,stroke:#333333,stroke-width:2px
style SparkProcessing fill:#ffecd6,stroke:#E25A1C,stroke-width:2px
style IcebergLakehouse fill:#e6f3ff,stroke:#4A90E2,stroke-width:2px
style Topics fill:#ffffff,stroke:#333333,stroke-width:1px
style Monitoring fill:#FFF3E0,stroke:#E6522C,stroke-width:2px
style AnalyticsGovernance fill:#E6EEFF,stroke:#0052CC,stroke-width:2px
style FastAPI fill:#B2DFDB,stroke:#009688,stroke-width:2px